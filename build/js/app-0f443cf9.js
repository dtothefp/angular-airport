var app=angular.module("airportApp",["ngResource","ngAnimate","ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("chooseAirports",{url:"/",templateUrl:"templates/choose_airport.html"}).state("viewAirports",{url:"/view",templateUrl:"templates/view_airports.html"})}]),app.factory("RequestService",["$resource",function($resource){var makeRequest={};return makeRequest.allAirports=$resource("/airportReq"),makeRequest.compareAirports=$resource("/api/:origin/:dest",{origin:"@origin",dest:"@dest"}),makeRequest}]),app.factory("ShareScope",["$rootScope",function($rootScope){var selectedAirports,sc={};return sc.setAirports=function(response){selectedAirports=response},sc.getAirports=function(){return $rootScope.$broadcast("dataShared"),selectedAirports},sc}]),app.controller("MainController",["$scope","$rootScope","$location","$state",function($scope,$rootScope,$location){$scope.showLoader=!0,$scope.frontPage=!0,$scope.viewPage=!1,$scope.$on("hideLoader",function(){$scope.showLoader=!1}),"/view"===$location.path()&&$location.path("/"),$rootScope.$on("$locationChangeStart",function(){console.log("location change listener",$location.path()),"/"===$location.path()?($scope.frontPage=!0,$scope.viewPage=!1):"/view"===$location.path()&&($scope.frontPage=!1,$scope.viewPage=!0)})}]),app.controller("ChooseAirportController",["$scope","$http","RequestService","$state","ShareScope","$rootScope","$location",function($scope,$http,RequestService,$state,ShareScope){var originCode,destCode;$scope.limit=10,$scope.callback=function(data){return data},$http.get("/airportReq").success(function(data){$scope.airports=data.airports,$scope.$emit("hideLoader")}),$scope.setOrigin=function(airport){originCode=airport.code,$scope.queryOrigin=airport.name},$scope.setDest=function(airport){destCode=airport.code,$scope.queryDest=airport.name},$scope.getAirportData=function(){RequestService.compareAirports.get({origin:originCode,dest:destCode},function(resp){$state.go("viewAirports"),ShareScope.setAirports(resp)},function(err){console.log("error",err)})},$scope.clearAirportData=function(){$scope.queryOrigin="",$scope.queryDest="",$scope.airportData=""}}]),app.controller("ViewAirportsController",["$scope","ShareScope",function($scope,ShareScope){$scope.airportData=ShareScope.getAirports()}]),app.directive("selectAirport",[function(){return{restrict:"A",scope:{set:"&"},link:function(scope,elm){elm.on("click",function(){scope.set({name:elm.text()})})}}}]),app.directive("verticalAlign",function(){return{restrict:"A",link:function(scope,elm){function sizeElm(){elm.css("margin-top","-"+elm[0].offsetHeight/2+"px")}sizeElm(),window.addEventListener("resize",sizeElm)}}}),app.directive("map",["$rootScope","$timeout","ShareScope",function($rootScope,$timeout,ShareScope){return{restrict:"A",link:function(scope,elm){var map,airportData=this.getAirports(),bounds=new google.maps.LatLngBounds,mapOptions={mapTypeId:"roadmap"};map=new google.maps.Map(elm[0],mapOptions);var marker,i,markers=[[airportData.origin.name,airportData.origin.lat,airportData.origin.lng],[airportData.dest.name,airportData.dest.lat,airportData.dest.lng]],infoWindowContent=[['<div class="info_content"><h3>Origin: '+airportData.origin.name+"</h3><p>Distance to Destination: "+airportData.distance+" Nautical Miles</p></div>"],['<div class="info_content"><h3>Destination: '+airportData.dest.name+"</h3><p>Distance to Origin: "+airportData.distance+" Nautical Miles</p></div>"]],infoWindow=new google.maps.InfoWindow;for(i=0;i<markers.length;i++){var position=new google.maps.LatLng(markers[i][1],markers[i][2]);bounds.extend(position),marker=new google.maps.Marker({position:position,map:map,title:markers[i][0]}),google.maps.event.addListener(marker,"mouseover",function(marker,i){return function(){infoWindow.setContent(infoWindowContent[i][0]),infoWindow.open(map,marker)}}(marker,i)),google.maps.event.addListener(marker,"mouseout",function(){return function(){infoWindow.close()}}(marker,i))}map.fitBounds(bounds),window.addEventListener("resize",function(){map.fitBounds(bounds)});var boundsListener=google.maps.event.addListener(map,"bounds_changed",function(){this.setZoom(4),google.maps.event.removeListener(boundsListener)})}.bind(ShareScope)}}]);